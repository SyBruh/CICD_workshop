name: Build and Push
on:
  push:
    branches:
      - v[0-100].[0-100]
      - test
  

jobs:
    slarkNotification:    
        name: Slack Notification
        runs-on: ubuntu-latest
        steps:  
            - uses: actions/checkout@v2
            - name: Run Trivy vulnerability scanner in repo mode
              uses: aquasecurity/trivy-action@master
              with:
                scan-type: 'fs'
                ignore-unfixed: true
                format: 'table'
                output: 'test.txt'
                severity: 'HIGH,CRITICAL'

#            - name: Create File
#              run: echo "hello" > output.txt

#            - name: Debug OUTPUT
#              run: |
#                pwd
#                ls -la

            - uses: MeilCli/slack-upload-file@v3
              with:
                slack_token: ${{ secrets.SLACK_BOT_TOKEN }}
                channel_id: ${{ secrets.SLACK_CHANNEL_ID }}
                file_path: '/home/runner/work/CICD_workshop/CICD_workshop/test.txt'
                initial_comment: 'post by slack-upload-file'