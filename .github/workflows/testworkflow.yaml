name: Build and Push
on:
  push:
    branches:
      - v[0-100].[0-100]
      - test
  

jobs:
    slarkNotification:    
        name: Slack Notification
        runs-on: ubuntu-latest
        steps:  
            - uses: actions/checkout@v2
            - name: Slack Notification
              uses: rtCamp/action-slack-notify@v2
              
              env:
                SLACK_WEBHOOK: ${{secrets.SLACK_WEBHOOK_URL}}
                SLACK_WEBHOOK_TYPE: INCOMING_WEBHOOK
                SLACK_MSG_AUTHOR: SyBruh
                SLACK_TITLE: Image build and signed
                SLACK_MESSAGE: "*Name:* Testing\n*Metriculation:* abc123\n*Email:* <example.com|abc123>\n*Git:* <example.com|abc123>\n*Image:* <example.com|abc123>"
            
            - name: Run Trivy vulnerability scanner in repo mode
              uses: aquasecurity/trivy-action@master
              with:
                scan-type: 'fs'
                ignore-unfixed: true
                format: 'table'
                output: 'trivy-results.txt'
                severity: 'HIGH,CRITICAL'
            - name: Upload Trivy scan results to GitHub Security tab
              uses: github/codeql-action/upload-sarif@v2
              with:
                txt_file: 'trivy-results.txt'